variables:
  GIT_CLONE_PATH: $CI_BUILDS_DIR/cicd

stages:
  - generate
  - validate
  - configure

before_script:
  - source /home/sudarshan/ansible2.9/bin/activate

Generate the configuration:
  stage: generate
  script: 
    - ansible-playbook ansible-playbooks/generate_config.yaml -i ansible-playbooks/hosts.ini
    - pwd
    - cp -r ansible-playbooks/snapshot/configs /home/sudarshan/snapshot/configs
  # artifacts:
  #   paths: 
  #     - /home/sudarshan/snapshot/configs/*.cfg
  #   expire_in: 3 day

# Validate the configuration:
#   stage: validate
#   script:
#     - ansible-playbook ansible-playbooks/batfish_test.yaml -i ansible-playbooks/hosts.ini

Configures the devices:
  stage: configure
  script:
    - cat /home/gitlab-runner/builds/cicd/ansible-playbooks/snapshot/configs/Router1.cfg
    - cat /home/gitlab-runner/builds/cicd/ansible-playbooks/snapshot/configs/Router2.cfg
    - cat /home/gitlab-runner/builds/cicd/ansible-playbooks/snapshot/configs/Router3.cfg
    - cat /home/gitlab-runner/builds/cicd/ansible-playbooks/snapshot/configs/Router4.cfg

  #   - ansible-playbook ansible-playbooks/configure_device.yaml -i ansible-playbooks/hosts.ini
  # only: 
  #   - master