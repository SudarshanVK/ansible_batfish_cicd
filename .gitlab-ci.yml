variables:
  GIT_CLONE_PATH: $CI_BUILDS_DIR/cicd

stages:
  - generate
  - validate
  - configure

before_script:
  - source /home/sudarshanv/ansible2.9.6/bin/activate

Generate the configuration:
  stage: generate
  script: 
    - ansible-playbook ansible-playbooks/generate_config.yaml -i ansible-playbooks/hosts.ini
  # artifacts:
  #   paths: /var/lib/gitlab-runner/builds/rxauB3RV/0/root/ansible-batfish-cicd/ansible-playbooks/snapshot/configs/*.cfg
  # expire_in: 1 day

Validate the configuration:
  stage: validate
  script:
    - ansible-playbook ansible-playbooks/batfish_test.yaml -i ansible-playbooks/hosts.ini

Configures the devices:
  stage: configure
  script:
    - ansible-playbook ansible-playbooks/configure_device.yaml -i ansible-playbooks/hosts.ini
  only: 
    - master